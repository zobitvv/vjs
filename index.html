<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DPLAYER</title>
    <meta content="never" name="referrer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <link href="https://www.hls-player.net/fav.png" rel="icon" type="image/x-icon" />

    <meta content="webkit" name="renderer">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="true" name="x5-fullscreen">
    <meta content="app" name="x5-page-mode">
    <meta content="yes" name="full-screen">
    <meta content="application" name="browsermode">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" />

    <!-- Load HLS.js and DPlayer -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js" charset="utf-8"></script>

    <style>
        :root {
            --plyr-color-main: #00b2ff;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            overflow-y: hidden;
            background-color: black;
        }

        #dplayer {
            width: 100%;
            height: 100%;
        }

        .dplayer-logo {
            pointer-events: none;
            position: absolute;
            right: 10px;
            top: 10px;
            max-width: 150px;
            max-height: 150px;
        }

        @media (max-width: 760px) {
            .dplayer-logo {
                max-width: 100px;
                max-height: 100px;
            }
        }
    </style>
</head>

<body>
    <div id="dplayer"></div>

    <script>
        // Get URL parameter
        function getUrlParam(name) {
            const reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            const r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURIComponent(r[2]);
            return null;
        }

        // Get video URL from parameter
        const urltext = getUrlParam('url');

        // Load player on window load
        window.onload = () => {
            if (!urltext) {
                alert("No video URL specified in ?url=...");
                return;
            }

            // Initialize DPlayer
            const dp = new DPlayer({
                container: document.getElementById('dplayer'),
                autoplay: true,
                video: {
                    url: urltext,
                    type: 'auto',
                },
                lang: "en",
                pluginOptions: {
                    hls: {
                        debug: false  // set to true for HLS.js debug logging
                    },
                },
                logo: "https://i.postimg.cc/s2krfnhj/image-removebg-preview-1.png"
            });

            // Try autoplay with sound, fallback to muted
            const tryAutoPlay = async () => {
                const video = dp.video;
                try {
                    video.muted = false;
                    video.volume = 0.8;
                    await video.play();
                } catch (err1) {
                    try {
                        video.muted = true;
                        await video.play();
                        video.muted = false;
                    } catch (err2) {
                        console.warn("Autoplay failed:", err2);
                    }
                }
            };

            tryAutoPlay();

            // On user interaction, unmute and set volume
            ['click', 'touchstart', 'keydown'].forEach(evt =>
                document.addEventListener(evt, () => {
                    if (dp.video.muted) {
                        dp.video.muted = false;
                        dp.video.volume = 0.8;
                    }
                }, { once: true })
            );

            // Optional: Log any player errors
            dp.on('error', (e) => {
                console.error("DPlayer error:", e);
            });
        };
    </script>
</body>

</html>
